#!/usr/sbin/nft -f
# File: identifier.nft
# Title: Test file for the initial 'identifier ' highlightings.
# Description:
#   Identifier that starts with from 1st column may imply
#   a '[add] table' command.
#
# nftables manpage shows:
#
#   <table_id> <object_id> ...
#   <family> <table_id> <object_id> ...
#   rule <table_id> <object_id> ...
#   rule <family> <table_id> <object_id> ...
#   [rule] [family] table_id object_id ...
#
# Vim: nft_line/nft_base_cmd/nft_base_cmd_add/nft_base_cmd_add_table
# Bison: identifier/table_spec/chain_spec/rule_position/add_cmd/base_cmd/line
# Bison: identifier/table_spec/chain_spec/rule_position/'rule'/add_cmd/base_cmd/line
# Bison: identifier/'ip|ip6|inet|netdev|bridge|arp'/family_spec_explicit/family_spec/table_spec/chain_spec/rule_position/add_cmd/base_cmd/line
# Bison: identifier/'ip|ip6|inet|netdev|bridge|arp'/family_spec_explicit/family_spec/table_spec/chain_spec/rule_position/'rule'/add_cmd/base_cmd/line
#
################################################################################
# true positive test (properly hightlighted correctly; has good content; perfect)
################################################################################

# setup
add table T
add table ip Tip
add table ip6 Tip6
add table inet Tinet
add table netdev Tnetdev
add table bridge Tbridge
add table arp Tarp

add chain T C;
add chain ip Tip  Cip ;
add chain ip6 Tip6 Cip6;
add chain inet Tinet Cinet;
add chain netdev Tnetdev Cnetdev;
add chain bridge Tbridge Cbridge;
add chain arp Tarp Carp;

# Bison: identifier/table_spec/chain_spec/rule_position/add_cmd/base_cmd/line

# <table_id> <chain_id>
T C ip saddr 127.0.0.1 drop
ip Tip Cip ip saddr 127.0.0.1 drop
ip6 Tip6 Cip6 ip6 saddr fffe::ffff drop
inet Tinet Cinet ip saddr 127.0.0.1 drop
netdev Tnetdev Cnetdev ip saddr 127.0.0.1 drop
bridge Tbridge Cbridge ip saddr 127.0.0.1 drop
arp Tarp Carp arp hlen 16 drop

# <family_spec> <table_id> <chain_id>
T C goto C;
ip Tip Cip goto Cip;
ip6 Tip6 Cip6 jump Cip6;
inet Tinet Cinet continue;
netdev Tnetdev Cnetdev accept;
bridge Tbridge Cbridge drop;
arp Tarp Carp continue;

# 'table' <family_spec> <table_id> <chain_id>
table T {
    chain C { }
}

# Bison: identifier/'ip|ip6|inet|netdev|bridge|arp'/family_spec_explicit/family_spec/table_spec/chain_spec/rule_position/add_cmd/base_cmd/line
# 'add' 'rule' <family_spec> <table_id> <chain_id>
add rule T C ip saddr 127.0.0.1 accept
add rule ip Tip Cip ip saddr 127.0.0.1 drop
add rule ip6 Tip6 Cip6 ip6 saddr fffe::ffff accept
add rule inet Tinet Cinet ip saddr 127.0.0.1 drop
add rule netdev Tnetdev Cnetdev ip saddr 127.0.0.1 drop
add rule bridge Tbridge Cbridge ip saddr 127.0.0.1 drop
add rule arp Tarp Carp arp hlen 16 drop


# multi-line
table myTableID {
    chain myChainID { };
};

# Bison: identifier/'ip|ip6|inet|netdev|bridge|arp'/family_spec_explicit/family_spec/table_spec/chain_spec/rule_position/'rule'/add_cmd/base_cmd/line
