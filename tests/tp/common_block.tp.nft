#!/usr/sbin/nft -f
# File: common_block.nft
# Description: A test NFT file to exercise common_block Vim syntax group.
#
# nft_line/nft_common_block
#
################################################################################
# true positive test: properly hightlighted correctly; has good content; perfect
################################################################################

;
  ;
 ;  

# line/common_block/INCLUDE
include "directory/filename.filetype"
# line/common_block/INCLUDE/stmt_separator
include "directory/filename.filetype";
include "directory/filename.filetype"; 
include "directory/filename.filetype" ;
include "directory/filename.filetype" ; 
# line common_block 'include' <QUOTED_STRING>
include "filespec"
include "filename.filetype"
include "directory/filename.filetype"
include "https://directory/filename.filetype"  # valid filespec but URL are not processed here (filesystem reject)
include "file:///directory/filename.filetype"  # valid filespec but URL are not processed here (filesystem reject)

# line common_block 'define' identifier '=' initializer_expr
# line/common_block/DEFINE
define A=1
define A= 1
define A =1
define A = 1
define last=1
define last= 1
define last =1
define last = 1
define ABC= 1  # missing stmt_separator
define ABC = 1  ;
define ABC = 1, 2, 3  ;  # set
define ABC = 127.0.0.1  # missing stmt_separator
define ABC = 127.0.0.1;
define ABC = 127.0.0.1, 192.168.1.1;  # set
define ABC =-1   # missing stmt_separator
define ABC = -1   # missing stmt_separator
define ABC = -1;
define ABC = -1; 
define ABC = -1 ;
define ABC = -1 ; 
define port_range = 1024-32767
define port_range = 1024-32767 ;
define ABC = identifier # missing stmt_separator
define ABC = identifier ;
define ABC = $identifier # missing stmt_separator
define ABC = $identifier;
define ABC = "string"  # missing stmt_separator
define ABC = "string";

# line/common_block/DEFINE/initializer_expr/rhs_expr/.../primary_rhs_expr/set_expr/{}
define ABC = {};
define last = {   }
define ABC = { }
define ABC = { }
define ABC = {            }

# Set section
define ABC = { 1 };
define MY_SET = { 1, 2 }
define MY_SET = { 1, 2, 3, 4 };

define MY_IP = { 127.0.0.1 };
define MY_IP_SET = { 127.0.0.1, 192.168.1.1, 192.168.10.10 };

define ABC = { x };
define MY_PORTS = { test };
define MY_PORTS_SET = { test, ssh, tcp, icmp };

define MY_DEV = { "eth0" };

define MY_DEV = { 1024-2048 };

# Map section
define MY_MAP = { 1:1 };
define MY_MAP = { 1:tcp };
define MY_MAP = { 1:"abc" };
define MY_MAP = { 1 : "abc" };
define MY_MAP = { 1:"eth0",  2:"br0" };
define MY_MAP = { tcp : tcp };
define MY_MAP = { eth0:127.0.0.1 };
define MY_MAP = { eth0 : 127.0.0.1 };
define MY_MAP = { eth0:127.0.0.1, bro0:192.168.1.1 };
define MY_MAP = { 192.168.20.20: ssh };
define MY_MAP = { 192.168.20.20: ssh, 127.0.0.1: http };
define MY_MAP = { 192.168.20.20: 127.0.0.1 };
define MY_MAP = { 192.168.20.20: 127.0.0.1, 127.0.0.1: 127.0.0.1};

# line/common_block/DEFINE/initializer_expr/DASH_NUM
define negative_value = -1000
define negative_value = -1000 ;
#
# line common_block 'redefine' identifier '=' initializer_expr
# line/common_block/REDEFINE
redefine last = {}
redefine A = {}
redefine A={}
redefine last = {}
redefine A = { 1 }
redefine A = { 1,2, 3, 4 }
redefine A = { 127.0.0.1 }
redefine A = { 127.0.0.1, 192.168.1.7 }
redefine A = { };
redefine A = { x }; 
redefine A = { } ;
redefine A = { } ; 
redefine A = 2
redefine A = 123  # missing stmt_separator
redefine A = -123  # missing stmt_separator
redefine A = $ABC  # missing stmt_separator

# line common_block 'undefine' identifier 
# line/common_block/UNDEFINE
undefine last
undefine last;
undefine last; 
undefine last ; 
undefine A
undefine ABC
# line/common_block/UNDEFINE/stmt_separator
undefine A;
undefine A$BCDE;
undefine A_BCDE;
undefine A123DF; 
undefine A123DG ;
undefine A123DH ; 

error
error;
  error;
error ;
    error ;
error ;
error ; 
error  # inline comment line

# base_cmd add_cmd 'table' table_spec table_block common_block 'include'
table T {
    include "file"
}

# base_cmd add_cmd 'table' table_spec table_block common_block 'define'
table T { define A = 1 }
table T {
    define A = 1
    define A = 1 ;
    define last = 1
    define last = 1 ;
    define A = {} ;
}
# base_cmd add_cmd 'table' table_spec table_block common_block 'redefine'
table T { redefine A = 1 }
table T { redefine A = 1; }
table T {
    redefine A = 1
    redefine A = 1 ;
}
# base_cmd add_cmd 'table' table_spec table_block common_block 'undefine'
table T {
    undefine A
    undefine B
}
table xxxx { undefine abc ; }
table xxxx { undefine abc ; } ;

# base_cmd add_cmd 'table' table_spec table_block table_options 'comment'
# base_cmd add_cmd 'table' table_spec table_block 'comment' string
table T {
    comment Hello
    comment Hello
    comment Hello
    comment Hello
}
table bridge T { comment 'Hello world!' }
table T { comment "Hello world!" }
table netdev xxxx { comment "test" } ;
table xxxx { comment 'test' };
table arp xxxx { comment test;  };

# base_cmd add_cmd 'table' table_spec table_block 'policy' 'offload'
# base_cmd add_cmd 'table' table_spec table_block hook_spec 'type'
# base_cmd add_cmd 'table' table_spec table_block 'flags' flag_spec
table T {flags persist}
table T {flags dormant;}
table T {flags owner, persist,dormant };
table T {flags owner,persist ;}
table T {flags dormant,owner; }
table T {flags persist,dormant ; }
# base_cmd add_cmd 'table' table_spec table_block { table_options ';' }
table ip xxxx { flags persist, owner, dormant};
table xxxx { ; flags owner; comment "new stuff"; };
table T { flags dormant; chain C { type ; }; };

table myIpTable { flags dormant; }
table netdev myNetdev { flags dormant; }
table bridge myBridge { flags dormant; }
table arp myArpTable { flags dormant; }
table ip myIpTable { flags dormant; }
table ip6 myIp6Table { flags dormant; }
table inet myInetTable { flags dormant; }


