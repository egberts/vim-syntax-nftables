#!/usr/sbin/nft -f
# File: all-chain.nft
# Description: A false positive test NFT file to exercise 'chain' Vim syntax highlightings.
#
# Identifiers begin with an standard practice of allowing
# alphabetic character (a-z,A-Z) for first character followed
# by zero or more alphanumeric characters (a-z,A-Z,0-9),
# characters dash (-), and underscore (_).
#
# Dot, backslash, forward slash are discourage as dot
# confused nftable concatenation effort.
#
# base_cmd add_cmd 'chain'
# base_cmd 'add' add_cmd 'chain'
# base_cmd add_cmd 'table' TABLE_ID '{' table_block 'chain' CHAIN_ID '{' chain_block
# base_cmd 'add' add_cmd 'table' TABLE_ID '{' table_block chain' CHAIN_ID {' chain_block
# nft_line/nft_base_cmd/nft_base_cmd_add/nft_base_cmd_add_table/nft_add_table_chain_block policy_spec
#
################################################################################
# true positive test (properly hightlighted correctly; has good content; perfect
################################################################################

# input hook chain, type filter @ srcnat priority
add table ip table_id
chain ip table_id chain_id { type filter hook input priority srcnat; policy accept;};
delete chain ip table_id chain_id { type filter hook input priority srcnat; policy accept; };
delete table ip table_id

# prerouting hook chain, type nat @ mangle priority
add table inet table_id
chain inet table_id chain_id        { type nat hook prerouting priority mangle; policy accept; };
delete chain inet table_id chain_id { type nat hook prerouting priority mangle; policy accept; };
delete table inet table_id

define MY_PRIORITY = security
add table ip table_id
add chain ip table_id chain_id { type filter hook input priority $MY_PRIORITY; policy drop; }
delete chain ip table_id chain_id
delete table ip table_id
undefine MY_PRIORITY

add table ip table_id
add chain ip table_id chain_id    { type filter hook input priority 12345; policy drop; }
delete chain ip table_id chain_id { type filter hook input priority 12345; policy drop; }
delete table ip table_id

add table ip table_id
add chain ip table_id chain_id    { type filter hook input priority -12345; policy drop; }
delete chain ip table_id chain_id { type filter hook input priority 12345; policy drop; }
delete table ip table_id


add table ip table_id
chain ip table_id chain_id {  # regular base chain ('regular chain')
        ip daddr 192.168.1.100 dnat to 192.168.1.200;
}
delete chain ip table_id chain_id
delete table ip table_id

add table ip table_id
table ip table_id {
    chain chain_id {
        # hook base chain ('hook chain')
        type filter hook input priority 0; policy drop;
        ip daddr 192.168.1.100 dnat to 192.168.1.200;
    };
};
delete chain ip table_id chain_id { type filter hook input priority 0; policy drop; };


add table T;
add chain ip T C
delete chain ip T C

add chain ip T C    { type filter hook input priority 0; policy accept; }
delete chain ip T C { type filter hook input priority 0; policy accept; }

# base_cmd add_cmd 'chain' '{' chain_block common_block
add chain ip T C    { type filter hook input priority 0; policy accept; };
delete chain ip T C { type filter hook input priority 0; policy accept; };
destroy chain ip T C
delete table ip T
destroy table ip T

