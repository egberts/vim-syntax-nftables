#!/usr/sbin/nft -f
# File: limit.nft
# Description: A test NFT file to exercise '[add] limit' Vim syntax highlightings.
#
# Supports following syntaxes:
#
#   [ [ 'add' ] 'rule' ] 'limit' obj_spec limit_obj limit_config close_scope_limit
#   [ [ 'add' ] 'rule' ] 'limit' obj_spec limit_obj '{' limit_block '}' close_scope_limit
#   'create' 'limit' obj_spec limit_obj limit_config close_scope_limit
#   'delete' 'limit' obj_spec
#   'delete' 'limit' objid_spec
#   'delete' 'limit' ( obj_spec | objid_spec )
#   [ [ 'add' ] 'rule' ] 'limit'
#   [ [ 'add' ] 'rule' ] 'limit' 'table' table_spec
#
#
################################################################################
# true positive test: properly hightlighted correctly; has good content; perfect
################################################################################



# base_cmd add_cmd 'table' table_spec table_block 'limit' limit_block
table ip T { limit L { }; }
table ip6 T { limit L { }; }
table inet T { limit L { }; }
table netdev T { limit L { }; }
table bridge T { limit L { }; }
table arp T { limit L { }; }
table T { limit L { rate 15 byte }; }
table T { limit L { rate 15 bytes }; }
table T { limit L { rate over 15 / second }; }
table T { limit L { rate over 15 / minute }; }
table T { limit L { rate over 15 / hour }; }
table T { limit L { rate over 15 / day }; }
table T { limit L { rate over 15 / week }; }
table T { limit L { rate over 15 bytes / second }; }
table T { limit L { rate over 15 kbytes / minute }; }
table T { limit L { rate over 15 mbytes / hour }; }
table T { limit L { rate over 15 gbytes / day }; }
table T { limit L { rate over 15 pbytes / week }; }
table T { limit L { rate until 15 / second }; }
table T { limit L { rate until 15 / minute }; }
table T { limit L { rate until 15 / hour }; }
table T { limit L { rate until 15 / day }; }
table T { limit L { rate until 15 / week }; }
table T { limit L { rate until 15 bytes / second }; }
table T { limit L { rate until 15 bytes / minute }; }
table T { limit L { rate until 15 bytes / hour }; }
table T { limit L { rate until 15 bytes / day }; }
table T { limit L { rate until 15 bytes / week }; }
table T {
    limit L {
        rate 1 / second
        rate 1 / second burst 1 packet
        rate over 1 / second
        rate over 1 / second burst 15 packets
        rate until 60 / minutes burst 360 packets
        rate 1 mbytes / second
        rate 1 mbytes / second burst 1 gbyte
        rate over 1 mbytes / second
        rate over 1 mbytes / second burst 15 gbyte
        rate until 60 mbytes / minutes burst 360 gbyte
        # common_block
        include "/directory/subdirectory/filename.filetype"
        define A = 1
        redefine A = 2
        undefine A
    }
}
table T { limit L { } }


table T {
    set S {
        limit rate 15 / second
        limit rate 15 / second burst 15 / hour
        limit rate 15 mbytes / second
        limit rate 15 mbytes / second burst 15 kbytes / hour
    }
}


table T {
    limit L { 
        # comment line
        include "my_secret_limits.nft";
        rate 10/second 
        rate over 1/minute burst 5 packets
        rate until 3/hour burst 30 packets
        rate until 3 Mbytes/hour burst 30 bytes 
        comment "nice limits there"
    }
};

# limit_rate_pkts->limit_config->identifier->table_spec->'limit'->'create'->create_cmd->base_cmd
create limit myIp6Table myIp6Limit rate 1 / week

# limit_rate_pkts->limit_config->identifier->table_spec->'limit'->'create'->create_cmd->base_cmd
create limit myIpTable myIpLimit rate over 3600000/ day
create limit myInetTable myInetLimit rate until 1/second

# limit_rate_pkts->limit_config->identifier->table_spec->'limit'->'create'->create_cmd->base_cmd
create limit myNetdevTable myNetdevLimit rate 1/minute burst 5 packets
create limit myBridgeTable myBridgeLimit rate 1 /hour 

# limit_config->obj_spec->'limit'->'create'->add_cmd->base_cmd
# limit_config->identifier->family_spec->table_spec->'limit'->'create'->create_cmd->base_cmd
create limit ip6 myIp6Table myIp6Limit rate 1 / week
create limit ip myIpTable myIpLimit rate 1/ day
create limit inet myInetTable myInetLimit rate 1/second
create limit netdev myNetdevTable myNetdevLimit rate 1/minute 
create limit bridge myBridgeTable myBridgeLimit rate 1 /hour 
create limit arp myBridgeTable myBridgeLimit rate 1 /hour 

# TODO list limit
# obj_spec->'limit'->list_cmd->base_cmd
list limit table_id limit_id
list limit ip table_id limit_id
list limit ip6 table_id limit_id
list limit inet table_id limit_id
list limit netdev table_id limit_id
list limit bridge table_id limit_id
list limit arp table_id limit_id

# ruleset_spec->'limits'->'list'->list_cmd->base_cmd
list limits ip 
list limits ip6
list limits inet 
list limits netdev 
list limits bridge 
list limits arp 

# 'table'->'limits'->'list'->list_cmd->base_cmd
list limits table table_id
list limits table ip table_id
list limits table ip6 table_id
list limits table inet table_id
list limits table netdev table_id
list limits table bridge table_id
list limits table arp table_id


